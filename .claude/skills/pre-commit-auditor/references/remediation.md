# Remediation Guide

Fix instructions for each pre-commit audit violation.

## PZ-001: Protocol Zero

**Violation:** Forbidden attribution phrase detected.

**Fix:** Remove or rephrase the text. Replace conversational language with cold, precise, technical phrasing. Never reference the authoring process.

**Examples:**

| Before | After |
|---|---|
| "I have updated the coordinator" | (delete — no narrative in code comments) |
| "AI-assisted implementation" | (delete — no attribution markers) |
| "Generated by Claude" | (delete entirely) |

## FU-001: Force Unwrap

**Violation:** Force unwrap operator (`!`) detected.

**Fix:** Replace with safe unwrapping:

```swift
// Violation
let value = optionalValue!

// Fix: guard let
guard let value = optionalValue else { return }

// Fix: if let
if let value = optionalValue {
    use(value)
}

// Fix: nil coalescing
let value = optionalValue ?? defaultValue
```

## DA-001: Debug Artifact

**Violation:** Print or debug statement outside `#if DEBUG` block.

**Fix:** Either remove the statement or wrap in a debug guard:

```swift
// Violation
print("debug info")

// Fix: remove entirely (preferred)

// Fix: guard with #if DEBUG (if truly needed)
#if DEBUG
print("debug info")
#endif

// Fix: use os.Logger (permitted per governance)
import os
private let logger = Logger(subsystem: "com.app", category: "debug")
logger.debug("debug info")
```

## DP-001: Deprecated API

**Violation:** Prohibited framework or API pattern detected.

**Migration table:**

| Deprecated | Replacement |
|---|---|
| `ObservableObject` | `@Observable` class |
| `@Published var` | Regular `var` in `@Observable` class |
| `@StateObject` | `@State` |
| `@EnvironmentObject` | `@Environment` |
| `DispatchQueue.main.async` | `@MainActor` or `MainActor.run` |
| `DispatchGroup` | `TaskGroup` / `withTaskGroup` |
| `PreviewProvider` | `#Preview` macro |

## SL-001: Secret Leakage

**Violation:** Plaintext secret, token, or webhook URL detected.

**Fix:** Never commit plaintext secrets. For webhook URLs, use XOR-encoded byte arrays per governance §5.1. For other secrets, use environment-based injection or Keychain storage.

```swift
// Violation
let webhookURL = "https://discord.com/api/webhooks/..."

// Fix: XOR-encoded byte array
private static let encodedWebhookBytes: [UInt8] = [0x4A, 0x2B, ...]
```

## CC-001: Commit Message

**Violation:** Commit message does not follow Conventional Commits format.

**Required format:** `type(scope): imperative description`

**Valid types:** `feat`, `fix`, `refactor`, `test`, `chore`, `docs`

**Valid scopes:** `coordinator`, `audio`, `haptics`, `webhook`, `ch1`-`ch6`, `assets`, `tests`

**Rules:**

- Description starts with lowercase letter
- No trailing period
- 72 character maximum on first line
- No attribution phrases

```md
feat(ch2): add obstacle spawning with parallax scrolling
fix(audio): resolve playback interruption on incoming call
test(webhook): add retry backoff verification
```

## CB-001: Combine Usage

**Violation:** Combine framework type or operator detected.

**Fix:** Replace with Observation framework and async/await:

| Combine Pattern | Swift Concurrency Replacement |
|---|---|
| `import Combine` | Remove import |
| `@Published var x` | `var x` in `@Observable` class |
| `sink { }` | `onChange` or `withObservationTracking` |
| `PassthroughSubject` | `AsyncStream` |
| `CurrentValueSubject` | Property in `@Observable` class |
| `AnyPublisher` | `AsyncSequence` |
