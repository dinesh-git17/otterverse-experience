# Starlight Sync — Implementation Phase Plan

**Document ID:** PHASES-001
**Methodology:** Walking Skeleton → Vertical Slice → MVP
**Sequencing Model:** Risk-adjusted critical path with Finish-to-Start dependencies
**Gate Criteria:** Each phase must satisfy its Definition of Done before dependent phases begin work.

---

## Phase Completion Status

| Phase | Status |
|-------|--------|
| PH-01 | **COMPLETE** |
| PH-02 | **COMPLETE** |
| PH-03 | **COMPLETE** |
| PH-04 | **COMPLETE** |
| PH-05 | **COMPLETE** |
| PH-06 | **COMPLETE** |
| PH-07 | Pending |
| PH-08 | Pending |
| PH-09 | Pending |
| PH-10 | Pending |
| PH-11 | Pending |
| PH-12 | Pending |
| PH-13 | Pending |
| PH-14 | Pending |
| PH-15 | Pending |
| PH-16 | Pending |
| PH-17 | Pending |

---

## Phase Dependency Graph

```md
PH-01 ──► PH-02 ──► PH-07 ──► PH-08 ──► PH-09 ──► PH-10 ──► PH-11 ──► PH-13 ──► PH-14 ──► PH-15 ──► PH-16 ──► PH-17
  │          │                                                              ▲
  │          ├──► PH-03 ──► PH-05 ─────────────────────────────────────────┘
  │          │      ▲
  │          ├──► PH-04 ──► PH-05
  │          │
  │          └──► PH-06 ──► PH-07
  │
  └──► PH-12 ──► PH-13
```

---

## Master Phase Table

| Phase # | Phase Name | Design Doc §§ | Description | Dependencies | Primary Owner | Risk Level | Blocking Inputs | Outputs Produced | Definition of Done | Estimated Complexity |
|---------|-----------|---------------|-------------|-------------|---------------|------------|----------------|-----------------|-------------------|---------------------|
| PH-01 | Xcode Project Scaffold | §8.1, §10.1, §10.2, §9.4 | Initialize Xcode project targeting iOS 19+ / iPhone 17 Pro. Configure signing, provisioning, bundle identifier. Create directory structure per §8.1 (`Coordinators/`, `Managers/`, `Services/`, `Chapters/`, `Models/`, `Components/`, `Audio/`, `Haptics/`). Create `Assets.xcassets` with image set and `Sprites.spriteatlas` groups. Configure `.gitignore` for Xcode/Swift. Initialize git repository with initial commit containing project skeleton, `CLAUDE.md`, and `Design-Doc.md`. | None | iOS Engineer | Low | Active Apple Developer Program enrollment. Xcode toolchain with Swift 5.9+ and iOS 19 SDK. | Buildable empty Xcode project. Directory structure per §8.1. `.gitignore`. Asset catalog with placeholder groups. Initial git commit on `main`. | Project builds with zero errors and zero warnings on `xcodebuild build`. Directory tree matches §8.1 layout. `.gitignore` excludes `*.xcuserdata`, `DerivedData/`, `.build/`. Git repository initialized with `CLAUDE.md` and `Design-Doc.md` committed. | S |
| PH-02 | FlowCoordinator State Machine | §4.1, §4.2, §4.3, §3.1 | Implement `FlowCoordinator` as an `@Observable` `@MainActor` class. Define chapter enum (6 cases). Implement linear state transitions (Chapter 1→6, no backward navigation). Implement `UserDefaults` checkpoint persistence (`highestUnlockedChapter: Int`). Implement resume-from-checkpoint on app launch. Build `StarlightSyncApp.swift` entry point with view routing switch that renders placeholder views per chapter. This is the walking skeleton: a runnable app that transitions through empty chapter shells. | PH-01 | iOS Architect | Low | Buildable Xcode project (PH-01). | `FlowCoordinator.swift` with chapter enum, state transitions, and persistence. `StarlightSyncApp.swift` with view routing. Placeholder views for all 6 chapters. App launches and navigates through placeholder shells. | App launches on simulator. `FlowCoordinator` advances through all 6 chapters sequentially. `highestUnlockedChapter` persists to `UserDefaults` and restores on relaunch. No backward navigation possible. All chapter identifiers are type-safe enums (no stringly-typed keys). | M |
| PH-03 | AudioManager Singleton | §5, §7.4, §8.1, §8.2, §8.4, §7.9.2 | Implement `AudioManager` singleton wrapping `AVAudioPlayer`. Configure `AVAudioSession` with `.playback` category (audio plays with Silent Switch on). Implement dual-player cross-fade strategy (500ms fade-in / fade-out per §7.4). Register `AVAudioSession.interruptionNotification` observer: pause all playback on `.began`, resume on `.ended` with `.shouldResume`. Implement `prepareToPlay()` pre-loading for all audio assets. Expose SFX playback API for one-shot sound effects independent of BGM cross-fade. | PH-02 | iOS Engineer | Medium | `FlowCoordinator` (PH-02) for interruption-driven game state pause. Audio asset files in `Audio/` and `Audio/SFX/` directories. | `AudioManager.swift` with session config, cross-fade, interruption handling, SFX playback, and pre-load API. | `AVAudioSession` category is `.playback`. Cross-fade executes in ≤500ms with no audible gap. Interruption observer pauses playback on `.began` and resumes on `.ended`. `prepareToPlay()` called for all players during pre-load. No `DispatchQueue`, `Timer`, or Combine usage. Beat-critical playback uses `CACurrentMediaTime()`. | L |
| PH-04 | HapticManager Singleton | §5, §7.6, §8.3, §7.9.2 | Implement `HapticManager` singleton wrapping `CHHapticEngine`. Implement engine lifecycle: `stoppedHandler` (restart on unexpected stop), `resetHandler` (re-register patterns and restart). Load and cache all 3 AHAP patterns (`heartbeat.ahap`, `capacitor_charge.ahap`, `thud.ahap`) as `CHHapticPattern` instances. Implement graceful degradation: if engine fails to start or stalls, silently degrade without propagating errors to the UI layer. Expose pattern playback API via `CHHapticPatternPlayer`. | PH-02 | iOS Engineer | Medium | `FlowCoordinator` (PH-02). AHAP pattern files in `Haptics/` directory. | `HapticManager.swift` with engine lifecycle, pattern cache, playback API, and graceful degradation. | `CHHapticEngine` starts successfully on supported hardware. `stoppedHandler` and `resetHandler` are registered and attempt engine recovery. All 3 AHAP patterns load and cache without error. Engine failure does not crash the app or propagate to the view layer. No force unwraps on engine or pattern optionals. | M |
| PH-05 | Asset Pre-load Pipeline | §7.9.1, §7.9.2, §7.9.3, §7.9.4, §7.9.5, §4.4 | Implement the launch pre-load orchestration sequence defined in §7.9.2. Decode HEIC backgrounds to `UIImage` on background threads via `CGImageSource`. Pre-load `SKTextureAtlas` via `preload(completionHandler:)`. Trigger `prepareToPlay()` on all `AVAudioPlayer` instances. Parse AHAP files into `CHHapticPattern` cache. Verify custom font registration (if adopted). Retain all decoded assets as strong references for session duration (no eviction). Coordinate with Chapter 1's 3-second long-press to mask load time. | PH-03, PH-04 | iOS Engineer | Medium | `AudioManager` (PH-03) and `HapticManager` (PH-04) initialized. All raw asset files (HEIC, PNG, M4A, AHAP) present in bundle directories. | Asset pre-load coordinator module. All image, texture, audio, and haptic assets decoded and resident in memory before Chapter 1 interaction completes. | All 7 HEIC backgrounds decode to `UIImage` without main-thread stall. All 4 sprite textures pre-loaded via `SKTextureAtlas.preload()`. All 7 audio players prepared via `prepareToPlay()`. All 3 AHAP patterns parsed and cached. Total decoded footprint ≤300MB per §7.9.3 budget. Pre-load completes within the Chapter 1 interaction window (~3s). | M |
| PH-06 | GameConstants & Type-Safe Models | §4.6, §4.7, §3.8, §7.5 | Create `GameConstants.swift` namespace containing all game tuning values as named constants: Auto-Assist thresholds (3 deaths, 3 incorrect, 5 misses, 10s idle), difficulty modifiers (speed −20%, gap +20%, hit window ±150ms/±300ms), timing values (500ms cross-fade, 60s runner duration, 45s firewall duration), physics tuning, and the Chapter 4 beat map `[TimeInterval]` array. Define type-safe enums for chapter identifiers, asset names, `UserDefaults` keys, and SFX identifiers. Zero magic numbers in game logic after this phase. | PH-02 | iOS Engineer | Low | `FlowCoordinator` chapter enum (PH-02) for alignment. Beat map requires `audio_bgm_main` track for manual timestamp authoring. | `GameConstants.swift` with all tuning values, thresholds, and beat map. Type-safe enums for asset identifiers, chapter IDs, and persistence keys. | Every numeric literal in game logic traces to a named constant in `GameConstants`. Beat map array is monotonically increasing and within track duration per §7.5. No stringly-typed `UserDefaults` access anywhere in the codebase. No magic numbers in any chapter implementation. | S |
| PH-07 | Chapter 1 — The Handshake | §3.2, §7.2 (`img_bg_intro`), §7.6 (`capacitor_charge.ahap`), §7.4 (`sfx_haptic_thud`), §12.2 | Implement `HandshakeView.swift`. Deep black OLED background with pulsing fingerprint glyph (`touchid` SFSymbol). Long-press gesture (minimum 3 seconds) triggering `capacitor_charge.ahap` haptic pattern with rising intensity. On completion: `sfx_haptic_thud` plays, screen transitions via CRT turn-on effect (scanline + brightness ramp animation). Implement Reduce Motion fallback: replace CRT effect with simple cross-fade. Include `#Preview` macro. Report completion to `FlowCoordinator`. | PH-02, PH-06 | iOS Engineer | Low | `FlowCoordinator` (PH-02). `GameConstants` (PH-06). `HapticManager` for pattern playback. `AudioManager` for SFX. `img_bg_intro` asset. | `HandshakeView.swift` with long-press interaction, haptic feedback, CRT transition, and Reduce Motion fallback. `CRTTransitionView.swift` in `Components/`. | Long-press gesture requires ≥3s hold. `capacitor_charge.ahap` plays during hold with rising intensity. `sfx_haptic_thud` fires on completion snap. CRT turn-on effect animates on completion. Reduce Motion replaces CRT with cross-fade. `FlowCoordinator` advances to Chapter 2 on completion. `#Preview` macro present. View body ≤80 lines. | M |
| PH-08 | Chapter 2 — The Packet Run | §3.3, §3.8, §7.2 (`img_bg_runner`), §7.3 (`sprite_otter_player`, `sprite_obstacle_glitch`, `sprite_heart_pickup`), §7.4 (`sfx_success_chime`), §4.3, §11.5 | Implement `PacketRunScene.swift` (`SKScene` subclass) and `PacketRunView.swift` (`SpriteView` wrapper). Neon grid with parallax starfield background. Player character (`Otter-Dinn` on hoverboard): tap to jump, hold to glide. Obstacle spawning ("Lag Spikes") with `SKPhysicsBody` category bitmasks for collision. Heart collectibles with `sfx_success_chime` on pickup. Win condition: survive 60s OR collect 20 hearts. Auto-Assist: after 3 deaths, obstacle speed −20%, gap width +20%. Target 120fps via `preferredFramesPerSecond = 120`. Implement `willMove(from:)` cleanup. Set `SKScene` reference to `nil` on removal from SwiftUI hierarchy. | PH-02, PH-06 | iOS Engineer | High | `FlowCoordinator` (PH-02). `GameConstants` (PH-06) for speed, gap, threshold values. Sprite assets in atlas. `AudioManager` for SFX. `img_bg_runner` background. | `PacketRunScene.swift` with physics, spawning, collision, scoring, and Auto-Assist. `PacketRunView.swift` wrapping `SpriteView`. | Player jumps on tap and glides on hold. Obstacles spawn with physics-based collision (category bitmasks, no frame-by-frame distance checks). Hearts increment score with `sfx_success_chime`. Game ends at 60s survival or 20 hearts collected. Auto-Assist activates after 3 deaths with correct modifiers. `willMove(from:)` calls `removeAllChildren()` and `removeAllActions()`. `SKScene` set to `nil` on view removal. `preferredFramesPerSecond = 120`. `FlowCoordinator` advances on win. `#Preview` macro present. | XL |
| PH-09 | Chapter 3 — The Cipher | §3.4, §3.8, §7.2 (`img_bg_cipher`), §7.4 (`sfx_click`, `sfx_success_chime`, `sfx_haptic_thud`), §7.6 (`thud.ahap`) | Implement `CipherView.swift` and `CipherWheelView.swift`. Brushed metal/glass Cryptex interface over `img_bg_cipher` background. Three vertically arranged segment scroll wheels: "THIS IS", "CRIMINAL", "BEHAVIOUR". Each wheel scrolls through scrambled phrase segments (not individual letters). Haptic click per scroll tick (`sfx_click` + inline `CHHapticEvent`). Heavy thud on correct segment alignment (`thud.ahap` + `sfx_haptic_thud`). Win condition: all three wheels correctly aligned. Auto-Assist: after 3 incorrect attempts, correct segment highlighted with subtle glow. Spaces between segments pre-filled. | PH-02, PH-06 | iOS Engineer | Medium | `FlowCoordinator` (PH-02). `GameConstants` (PH-06) for attempt threshold. `HapticManager` for pattern playback. `AudioManager` for SFX. `img_bg_cipher` background. | `CipherView.swift` with puzzle container and validation. `CipherWheelView.swift` with scroll interaction, haptics, and Auto-Assist glow. | Three wheels render with scrambled segments. Scroll gesture moves segments with haptic click per tick. Correct alignment fires `thud.ahap` + `sfx_haptic_thud`. Win triggers on all 3 correct. Auto-Assist activates after 3 failures with glow on correct segment. `FlowCoordinator` advances on solve. Monospaced font (`SF Mono`) for wheel text. `#Preview` macros present. | L |
| PH-10 | Chapter 4 — The Firewall | §3.5, §3.8, §7.2 (`img_bubble_shield`), §7.3 (`sprite_noise_particle`), §7.4 (`sfx_shield_impact`), §7.5, §4.3, §4.5, §11.5 | Implement `FirewallScene.swift` (`SKScene` subclass) and `FirewallView.swift` (`SpriteView` wrapper). Center-screen otter bubble shield (`img_bubble_shield`). Noise particles (`sprite_noise_particle`) spawn from screen edges on beat map timestamps synced to `audio_bgm_main` via `CACurrentMediaTime()`. Tap detection: user taps the side where noise approaches. Hit window: ±150ms default. Win condition: survive song verse (~45s). Auto-Assist: after 5 misses, hit window widens to ±300ms. Target 120fps. Implement `willMove(from:)` cleanup. | PH-02, PH-06, PH-03 | iOS Engineer | High | `FlowCoordinator` (PH-02). `GameConstants` (PH-06) for beat map, hit windows, miss threshold. `AudioManager` (PH-03) for synchronized playback with `CACurrentMediaTime()`. Sprite + shield assets. Finalized beat map in `GameConstants`. | `FirewallScene.swift` with beat-synced spawning, tap detection, hit window scoring, and Auto-Assist. `FirewallView.swift` wrapping `SpriteView`. | Noise particles spawn at beat map timestamps (±10ms accuracy via `CACurrentMediaTime()`). Tap on correct side within ±150ms registers hit with `sfx_shield_impact`. 5 misses trigger Auto-Assist (±300ms window). Survive ~45s to win. `willMove(from:)` cleanup implemented. `SKScene` set to `nil` on removal. `preferredFramesPerSecond = 120`. `FlowCoordinator` advances on win. `#Preview` macro present. | XL |
| PH-11 | Chapter 5 — The Blueprint | §3.6, §3.8, §7.2 (`img_bg_blueprint`), §7.4 (`sfx_success_chime`, `sfx_error`) | Implement `BlueprintView.swift` and `HeartNodeLayout.swift`. Deep blue architectural blueprint background (`img_bg_blueprint`). 12 nodes forming a heart silhouette: 4 labeled cornerstones ("Paris", "New Apt", "Dog", "Coffee") at key waypoints + 8 unlabeled structural nodes. Sequential drag-to-connect: finger drags from node A→B→C in order. Incorrect connection snaps back to previous valid node with `sfx_error` + error haptic. Correct connection triggers `sfx_success_chime`. Win condition: all 12 nodes connected. Auto-Assist: after 10s idle, next correct node pulses with glow animation. | PH-02, PH-06 | iOS Engineer | Medium | `FlowCoordinator` (PH-02). `GameConstants` (PH-06) for idle threshold, node coordinates. `AudioManager` for SFX. `HapticManager` for error feedback. `img_bg_blueprint` background. | `BlueprintView.swift` with drag interaction, connection validation, and Auto-Assist. `HeartNodeLayout.swift` with node coordinates and heart geometry. | 12 nodes render in heart shape with 4 labeled cornerstones at correct positions. Sequential drag connects nodes in order only. Invalid connection snaps back with `sfx_error` + haptic. Valid connection renders line + `sfx_success_chime`. 10s idle triggers pulse glow on next correct node. All 12 connected completes chapter. `FlowCoordinator` advances on completion. `#Preview` macros present. | L |
| PH-12 | WebhookService | §9.1, §9.2, §9.3, §9.4, §7.8, §5 | Implement `WebhookService.swift`. Store Discord webhook URL as XOR-encoded `[UInt8]` byte array with compile-time XOR key per §9.2. Implement runtime decode function (XOR key applied at call site, decoded string never persisted or logged). Implement `POST` to decoded URL with `Content-Type: application/json` and payload `{"content": "@everyone SHE SAID YES! ❤️"}`. Implement 3x retry with exponential backoff (1s, 2s, 4s). Fire-and-forget: use `Task {}` for non-blocking execution. Silent discard on total failure — no error surfaced to UI. | PH-01 | iOS Engineer | Low | Xcode project (PH-01). Discord webhook URL (provided by project owner, never committed in plaintext). | `WebhookService.swift` with XOR-encoded URL, decode function, POST request, 3x retry, and silent failure. | Webhook URL is stored as `[UInt8]` — no plaintext `String` literal in source. Decoded URL is never logged or persisted. POST sends correct JSON payload. Retry fires 3 times with 1s/2s/4s backoff. Total failure is silently discarded. Webhook execution never blocks the calling thread. `URLSession` is the only networking API used. No plaintext URL in comments, tests, or docs. | M |
| PH-13 | Chapter 6 — The Event Horizon | §3.7, §7.2 (`img_finale_art`), §7.4 (`audio_bgm_finale`), §7.6 (`heartbeat.ahap`), §9.3, §11.4 | Implement `EventHorizonView.swift` and `FrictionSlider.swift`. White void background that slowly fills with color. Custom "Slide to Confirm" slider with progressive resistance: `drag_position = finger_distance ^ 0.8` logarithmic decay creating increasing heaviness. Display text: "Will you be mine forever?" On slider reaching 100%, execute in parallel: (1) fire `WebhookService` (non-blocking), (2) play `audio_bgm_finale`, (3) trigger confetti particle system, (4) cross-fade to `img_finale_art`. `heartbeat.ahap` plays during slider drag. Webhook failure must never block, delay, or alter the finale sequence. | PH-02, PH-06, PH-12 | iOS Engineer | High | `FlowCoordinator` (PH-02). `GameConstants` (PH-06) for slider exponent. `WebhookService` (PH-12). `AudioManager` for finale song. `HapticManager` for heartbeat pattern. `ConfettiView` component. `img_finale_art` and `audio_bgm_finale` assets. | `EventHorizonView.swift` with finale orchestration. `FrictionSlider.swift` with progressive resistance. `ConfettiView.swift` in `Components/`. | Slider resistance increases with `x^0.8` decay. Slider completion triggers webhook + music + confetti simultaneously. `audio_bgm_finale` starts at the exact frame slider reaches 100%. Webhook fires via `WebhookService` (non-blocking). Confetti particle system renders. `img_finale_art` cross-fades from white void. Webhook failure does not delay or alter any UI/audio behavior. `heartbeat.ahap` plays during drag. `#Preview` macros present. | XL |
| PH-14 | Cross-Chapter Transitions & Polish | §4.2, §7.4 (`audio_bgm_main` cross-fade), §11.5, §12.2, §12.3 | Integrate chapter-to-chapter transition animations. Implement `matchedGeometryEffect` spatial transitions between chapters with Reduce Motion fallback (cross-fade). Wire `audio_bgm_main` looping from Chapter 1 completion through Chapters 2–5 with 500ms cross-fade on each transition. Verify `SpriteView` memory cleanup on all SpriteKit→SwiftUI transitions: `removeAllChildren()`, `removeAllActions()`, `SKScene = nil`. Ensure multi-sensory redundancy (§12.3): every feedback event has visual + audio + haptic channels. Validate all animations respect `UIAccessibility.isReduceMotionEnabled`. | PH-07, PH-08, PH-09, PH-10, PH-11, PH-13 | iOS Engineer | Medium | All 6 chapter implementations (PH-07 through PH-13). `AudioManager` cross-fade (PH-03). Asset pre-load pipeline (PH-05). | Seamless chapter transitions with animation and audio cross-fade. SpriteView memory leak prevention. Reduce Motion compliance across all chapters. | All 6 chapter transitions animate without loading flicker at 120fps. `audio_bgm_main` loops Chapters 2–5 with 500ms cross-fade. SpriteKit scenes deallocate cleanly (no retained `SKScene` references after transition). Reduce Motion enabled: all transitions use cross-fade, CRT effect replaced, particles reduced. Every feedback event provides at least 2 of 3 sensory channels (visual, audio, haptic). | L |
| PH-15 | Unit Test Suite | §13.1, §13.3, §7.1 (CLAUDE.md), §7.2 (CLAUDE.md), §7.3 (CLAUDE.md) | Implement `XCTest` suite per §13.1 coverage requirements. `FlowCoordinator`: chapter progression, checkpoint save/load, Auto-Assist trigger logic, first-launch edge case, resume-after-completion edge case. Cipher validation: correct segment matching, incorrect attempt counting, Auto-Assist activation at threshold. Webhook retry logic: 3x retry with backoff, silent discard, non-blocking execution (mock `URLSession` via `URLProtocol`). Beat map data: timestamps monotonically increasing, within track duration, correctly spaced. Follow `test_<unit>_<scenario>_<expectedResult>()` naming convention. No tests dependent on network, `CHHapticEngine`, or real audio timing. | PH-02, PH-09, PH-12, PH-06 | iOS Engineer | Low | `FlowCoordinator` (PH-02). Cipher validation logic (PH-09). `WebhookService` (PH-12). Beat map data in `GameConstants` (PH-06). | `XCTest` target with unit tests covering `FlowCoordinator`, cipher validation, webhook retry, and beat map data. `URLProtocol` mock for network tests. | All tests pass with 0 failures on `xcodebuild test`. `FlowCoordinator` tests cover: forward progression, no backward navigation, `UserDefaults` persistence, Auto-Assist triggers. Cipher tests cover: correct matching, 3-failure Auto-Assist activation. Webhook tests cover: 3x retry, backoff timing, silent failure (using `URLProtocol` mock). Beat map tests cover: monotonic ordering, within-duration bounds. Test names follow `test_<unit>_<scenario>_<expected>()` convention. No tests require network, device haptics, or real audio. | L |
| PH-16 | On-Device QA & Tuning | §13.2, §13.3, §16.2 | Full end-to-end playtest on iPhone 17 Pro (simulator does not support CoreHaptics). Validate all manual test cases from §13.2: haptic pattern feel per chapter, audio-haptic sync in Chapter 4, "The Special Song" plays at exact slider completion, seamless chapter transitions at 120fps, Auto-Assist activates correctly in all 4 chapters, app survives phone call interruption mid-chapter, app resumes from checkpoint after force-quit, webhook fires to Discord, progressive slider resistance feels immersive. Tune `x^0.8` slider exponent if needed. Verify beat map timing by feel. | PH-14, PH-15 | iOS Engineer + QA | High | All chapters integrated and transitioned (PH-14). Unit tests passing (PH-15). iPhone 17 Pro test device available. Discord webhook channel configured. | QA sign-off on all §13.2 test cases. Tuning adjustments committed (slider exponent, beat map, Auto-Assist thresholds). | Every test case in §13.2 table passes on-device. Haptic patterns feel correct subjectively. Audio-haptic sync in Chapter 4 is perceptible and satisfying. Slider resistance exponent is tuned to feel like "breaking through a barrier." Auto-Assist activates correctly via intentional failure in all 4 chapters. Phone call interruption pauses and resumes correctly. Force-quit and relaunch resumes at correct chapter. Webhook message appears in Discord channel. Zero crashes across 3 consecutive full playthroughs. | L |
| PH-17 | TestFlight Distribution | §10.3 | Archive build in Xcode. Upload to App Store Connect via Xcode Organizer. Wait for TestFlight processing (~10–30 min). Register Carolina as external tester. Send TestFlight invitation to Carolina's email. Verify TestFlight install on target device if accessible. Confirm build appears in App Store Connect with correct bundle ID, version, and build number. | PH-16 | iOS Engineer | Low | QA sign-off (PH-16). Active Apple Developer Program enrollment. App created in App Store Connect. Signing certificates and provisioning profile configured. Carolina's email address for TestFlight invitation. | Archived IPA uploaded to App Store Connect. TestFlight invitation sent to Carolina. Build installable via TestFlight on iPhone 17 Pro. | Build archives without error. Upload to App Store Connect succeeds. TestFlight processing completes without rejection. Invitation email sent to Carolina. Build installs and launches on target device via TestFlight. App completes full Chapter 1–6 flow on TestFlight build. | S |

---

## Phase Sequencing Rationale

| Sequencing Decision | Rationale |
|---|---|
| PH-01 → PH-02 first (Walking Skeleton) | Establishes the runnable app shell before any feature investment. Validates build pipeline, signing, and the `FlowCoordinator` state machine end-to-end. All subsequent phases attach to this skeleton. |
| PH-03, PH-04 before chapter work | `AudioManager` and `HapticManager` are consumed by every chapter. Building them before chapters prevents per-chapter integration rework and enables chapters to develop with real audio/haptic feedback from the start. |
| PH-06 before chapters | `GameConstants` eliminates magic numbers and provides type-safe identifiers. Every chapter depends on tuning values and asset enums defined here. Front-loading this prevents scattered literal definitions during chapter sprints. |
| PH-08, PH-10 flagged High Risk | SpriteKit chapters carry the highest implementation complexity (physics, beat sync, 120fps target, memory management). Scheduling them early surfaces integration risks before the critical path narrows. |
| PH-12 independent of chapter work | `WebhookService` has no chapter dependency beyond PH-01. It can be developed in parallel with chapter sprints, reducing critical path duration. Only PH-13 (Chapter 6) consumes it. |
| PH-14 after all chapters | Cross-chapter transitions require all chapter views to exist. This phase integrates the full linear flow, audio cross-fading, and SpriteView memory cleanup in a single pass. |
| PH-15 before PH-16 | Unit tests validate logic correctness before on-device QA. Catching regression bugs in automated tests prevents wasted device testing cycles. |
| PH-16 before PH-17 | On-device QA is the final gate before distribution. Tuning adjustments (slider exponent, beat map, thresholds) must be committed before the archival build. |

---

## Critical Path

```md
PH-01 → PH-02 → PH-06 → PH-08 → PH-10 → PH-13 → PH-14 → PH-15 → PH-16 → PH-17
```

The critical path runs through the highest-complexity phases (SpriteKit chapters and Chapter 6 finale). Any delay in PH-08 or PH-10 directly impacts MVP delivery. PH-03, PH-04, PH-05, PH-12 run on a parallel track and must merge before PH-14.

---

## Parallel Execution Opportunities

| Track | Phases | Merge Point |
|---|---|---|
| **Infrastructure Track** | PH-03, PH-04, PH-05 | Merge before PH-07 (first chapter consuming audio/haptics) |
| **Webhook Track** | PH-12 | Merges at PH-13 (Chapter 6 consumes `WebhookService`) |
| **Chapter Track A** | PH-07, PH-08 | Sequential (PH-07 validates CRT transition pattern used by other chapters) |
| **Chapter Track B** | PH-09, PH-11 | Can execute in parallel with PH-08, PH-10 after PH-06 completes |

---

## Risk Register

| Phase | Risk | Severity | Mitigation |
|---|---|---|---|
| PH-06 | Beat map authoring requires 1–2 hours of manual audio timestamping (§16.2) | Medium | Schedule beat map authoring as first task in PH-06. Validate timestamps against track duration in unit tests (PH-15). |
| PH-08 | SpriteKit `SpriteView` memory leaks on chapter transition (§11.5) | High | Enforce `willMove(from:)` cleanup and `SKScene = nil` pattern. Validate with Instruments Allocations trace during PH-16. |
| PH-10 | Audio-beat sync jitter if timing source is incorrect (§7.5) | High | Mandate `CACurrentMediaTime()` exclusively. Prohibit `Timer`, `DispatchQueue.asyncAfter`, `Task.sleep` for beat timing. Validate sync perceptually in PH-16. |
| PH-13 | Progressive slider exponent (`x^0.8`) may not feel right (§16.2) | Medium | Treat exponent as a `GameConstants` tunable. Reserve PH-16 tuning time for iterative adjustment on device. |
| PH-16 | Total implementation time exceeds estimate (§16.2) | Medium | Maintain parallel execution tracks. PH-12 and PH-09/PH-11 are parallelizable. Cut scope from PH-14 (polish) if schedule pressure emerges. |
| PH-17 | TestFlight processing rejection due to missing metadata or entitlement | Low | Validate App Store Connect configuration (bundle ID, signing, entitlements) during PH-01 scaffold. Run `xcodebuild archive` dry run before PH-17. |
